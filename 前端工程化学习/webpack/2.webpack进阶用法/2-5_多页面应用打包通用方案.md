## `webpack`的多页面打包

### 1、多页面打包的基本思路

每个页面对应一个entry，和一个html-webpack-plugin

```js
module.exports = {
    entry: {
        index: './src/index.js',
        search: './src/other.js'
    }
};
```

缺点：每次新增或删除页面需要修改webpack相关的配置



### 2、多页面打包的通用方案

动态获取entry和设置html-webpack-plugin的数量

- 利用glob.sync来全部同步获取目标文件的路径
- `entry: glob.sync(path.join(__dirname, './src/*/index.js'))`

```js
const setMPA = () => {
    const entry = {}
    const htmlWebpackPlugin = []
    const entryFiles = glob.sync(path.join(__dirname,'../src/*/index.js'))
    Object.keys(entryFiles)
        .map(index => {
            const entryFile = entryFiles[index]
            const match = entryFile.match(/src\/(.*)\/index\.js/)
            const pageName = match && match[1]
            entry[pageName] = entryFile
            htmlWebpackPlugin.push(
                new HtmlWebpackPlugin({
                    template:path.resolve(__dirname,`../src/${pageName}/index.html`),
                    filename:`${pageName}.html`,
                    chunks: ['vendors', pageName],
                    inject: true,
                    minify: {
                        html5: true,
                        collapseWhitespace: true,
                        preserveLineBreaks: false,
                        minifyCSS: true,
                        minifyJS: true,
                        removeComments: false
                    }
                }),
            )
        })
        return {
            entry,
            htmlWebpackPlugin
        }
}
const { entry, htmlWebpackPlugin } = setMPA();
module.exports = {
    entry: entry,
    plugins: [].concat(htmlWebpackPlugin)
}
```

