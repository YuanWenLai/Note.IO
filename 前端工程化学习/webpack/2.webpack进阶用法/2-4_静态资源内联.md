## `webpack`打包-静态资源内联

### 1、静态资源内联的意义

- 页面框架初始化代码脚本
- 上报相关埋点
- `css`内联避免页面闪动
- 小图片或者字体内联，减少`http`网络请求消耗



### 2、内联`html`和`js`相关包

使用`raw-loader`插件进行文件内联，由于`html-webpack-plugin`插件内置`ejs`语法来引入文件。



- 在`index.html`文件中使用`ejs`模板来引入`meta`相关配置的文件
- 在`index.html`文件中使用`ejs`模板来引入动态计算移动设备的`flexible.js`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <%= require('raw-loader!./meta.html')  %>
  <script>
    <%= require('raw-loader!../node_modules/lib-flexible/flexible.js')  %>
  </script>
</head>
<body>
  <div id="app"></div>
</body>
</html>
```

```html
// meta.html
<meta name="Keywords" content="lol直播,英雄联盟直播,dota2直播,dnf直播,cf直播,绝地求生直播，王者荣耀直播，球球大作战直播，游戏直播,赛事直播,YY直播,美女直播,户外直播,视频直播,虎牙直播"/>
<meta name="Description" content="虎牙直播是以游戏直播为主的弹幕式互动直播平台，累计注册用户2亿，提供热门游戏直播、电竞赛事直播与游戏赛事直播，手游直播等。包含英雄联盟lol，王者荣耀，绝地求生，和平精英等游戏直播，lol、dota2、dnf等热门游戏直播以及单机游戏、手游等游戏直播。"/>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="baidu-site-verification" content="GJcrsC6gXy" />
<meta name="baidu_union_verify" content="5ea44697c701baa2f69d4d6a685b3122">
<meta name="360-site-verification" content="e7ebef547974d9b5452addd5a6ab0c9f" />
<meta name="sogou_site_verification" content="GczIV7FOQS"/>
<meta name="google-site-verification" content="pF_C08APd5jWUShg77PY-V5hbhZCK6KnUAg543Ctt0g" />
<meta property="qc:admins" content="2531543776605116375" />
<meta property="wb:webmaster" content="c66c64f64a78003f" />

```



构建打包后的`index.html`：

```html

<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><meta name="Keywords" content="lol直播,英雄联盟直播,dota2直播,dnf直播,cf直播,绝地求生直播，王者荣耀直播，球球大作战直播，游戏直播,赛事直播,YY直播,美女直播,户外直播,视频直播,虎牙直播"/><meta name="Description" content="虎牙直播是以游戏直播为主的弹幕式互动直播平台，累计注册用户2亿，提供热门游戏直播、电竞赛事直播与游戏赛事直播，手游直播等。包含英雄联盟lol，王者荣耀，绝地求生，和平精英等游戏直播，lol、dota2、dnf等热门游戏直播以及单机游戏、手游等游戏直播。"/><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="baidu-site-verification" content="GJcrsC6gXy"/><meta name="baidu_union_verify" content="5ea44697c701baa2f69d4d6a685b3122"><meta name="360-site-verification" content="e7ebef547974d9b5452addd5a6ab0c9f"/><meta name="sogou_site_verification" content="GczIV7FOQS"/><meta name="google-site-verification" content="pF_C08APd5jWUShg77PY-V5hbhZCK6KnUAg543Ctt0g"/><meta property="qc:admins" content="2531543776605116375"/><meta property="wb:webmaster" content="c66c64f64a78003f"/>
    <script>
        // flexible.js 源码省略。。
    </script>
<link href="static/css/main3ec78ca401afbe76f09b.css" rel="stylesheet"></head><body><div id="app"></div><script src="static/js/chunk-libs.3ec78ca4.js"></script><script src="static/js/main.3ec78ca4.js"></script></body></html>
```



### 3、打包内联`css`到`html`

- 方案一：借助`style-loader`
- 方案二：使用配置`html-inline-css-webpack-plugin`

```js
module.exports = {
    module: {
        rules: [
            {
                test: /\.scss$/,
                use: [
                    {
                        loader: 'style-loader',
                        options: {
                            insertAt: 'top', // 样式插入到 <head>
                            singleton: true, //将所有的style标签合并成一个
                    	}
                    },
                    "css-loader",
                    "sass-loader"
                ],
            },
        ]
    },
};	
```

